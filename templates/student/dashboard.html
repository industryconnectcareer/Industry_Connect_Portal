{% extends "base.html" %}
{% block content %}

<div class="student-container">

    <!-- ========================== -->
    <!-- HEADER -->
    <!-- ========================== -->
    <div class="student-header">
        <h2>Welcome, {{ student.name }}</h2>
        <p class="sub">Your personalized career dashboard</p>
    </div>

    <!-- ========================== -->
    <!-- KPI CARDS -->
    <!-- ========================== -->
    <div class="student-grid">

        <!-- Readiness Score -->
        <a class="student-card" href="/student/score">
            <div class="icon-box">üìä</div>
            <h4>Job Readiness Score</h4>
            <div class="kpi-value">{{ readiness.total if readiness else 0 }}%</div>
        </a>

        <!-- Skill Badges -->
        <a class="student-card" href="/student/badges">
            <div class="icon-box">üèÖ</div>
            <h4>Skill Badges</h4>
            <div class="kpi-value">{{ badges|length }}</div>
        </a>

        <!-- Saved Items -->
        <a class="student-card" href="/student/saved-searches">
            <div class="icon-box">üîñ</div>
            <h4>Saved Internships & OJT</h4>
            <div class="kpi-value small">View</div>
        </a>

        <!-- AI Recommendations -->
        <a class="student-card" href="/student/recommendations">
            <div class="icon-box">ü§ñ</div>
            <h4>AI Recommendations</h4>
            <div class="kpi-value small">Explore</div>
        </a>

    </div>

    <!-- ========================== -->
    <!-- RECOMMENDATIONS SECTION -->
    <!-- ========================== -->
    <h3 class="section-title">Recommended Internships</h3>

    <div id="recommendations-container" class="internship-grid"></div>

    <!-- Skeleton Loader -->
    <div id="recommendations-loader" class="loader">
        <div class="skeleton-card"></div>
        <div class="skeleton-card"></div>
        <div class="skeleton-card"></div>
    </div>

    <!-- ========================== -->
    <!-- RECENTLY VIEWED -->
    <!-- ========================== -->
    <h3 class="section-title">Recently Viewed Internships</h3>

    <div class="internship-grid">
        {% if recent_items %}
            {% for item in recent_items %}
                <div class="reco-card">
                    <h4 style="color:#0a575d;">{{ item.title }}</h4>
                    <p>{{ item.company_name }}</p>
                    <p style="font-size:13px; color:#666;">{{ item.location }}</p>
                </div>
            {% endfor %}
        {% else %}
            <p style="color:#777;">You haven't viewed any internships yet.</p>
        {% endif %}
    </div>

</div>

<!-- ========================== -->
<!-- STYLES -->
<!-- ========================== -->
<style>
.student-container {
    max-width: 1100px;
    margin: auto;
    padding: 25px;
}

/* HEADER */
.student-header {
    text-align: center;
    margin-bottom: 25px;
}
.student-header h2 {
    font-size: 30px;
    font-weight: 700;
    color: #0a575d;
}
.student-header .sub {
    color: #666;
    font-size: 15px;
}

/* KPI GRID */
.student-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 20px;
    margin-bottom: 35px;
}

.student-card {
    background: rgba(255, 255, 255, 0.75);
    backdrop-filter: blur(6px);
    padding: 22px;
    border-radius: 16px;
    text-decoration: none;
    color: #222;
    box-shadow: 0px 4px 14px rgba(0,0,0,0.08);
    transition: 0.25s ease;
    text-align: center;
}
.student-card:hover {
    transform: translateY(-6px);
    box-shadow: 0px 8px 18px rgba(0,0,0,0.15);
}

/* Icons */
.icon-box {
    font-size: 34px;
    margin-bottom: 10px;
}

/* KPI Value */
.kpi-value {
    font-size: 32px;
    font-weight: 700;
    color: #0a575d;
    margin-top: 5px;
}
.kpi-value.small {
    font-size: 18px;
}

/* Section Title */
.section-title {
    font-size: 24px;
    font-weight: 700;
    color: #0a575d;
    margin: 20px 0;
}

/* Grid */
.internship-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap: 20px;
}

/* Cards */
.reco-card {
    padding: 18px;
    background: white;
    border-radius: 14px;
    box-shadow: 0px 4px 14px rgba(0,0,0,0.08);
    transition: 0.25s ease;
}
.reco-card:hover {
    transform: translateY(-6px);
    box-shadow: 0px 8px 18px rgba(0,0,0,0.12);
}

/* Loader */
.loader {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap: 20px;
    margin-top: 10px;
}

.skeleton-card {
    height: 140px;
    border-radius: 14px;
    background: linear-gradient(90deg, #eaeaea, #f5f5f5, #eaeaea);
    background-size: 200%;
    animation: loading 1.5s infinite;
}

@keyframes loading {
    0% { background-position: 200% 0; }
    100% { background-position: -200% 0; }
}
</style>

<!-- ========================== -->
<!-- JS: Load Recommendations -->
<!-- ========================== -->
<script>
document.addEventListener("DOMContentLoaded", function () {

    fetch("/student/api/recommendations")
        .then(res => res.json())
        .then(data => {

            document.getElementById("recommendations-loader").style.display = "none";
            let container = document.getElementById("recommendations-container");

            if (data.length === 0) {
                container.innerHTML = "<p style='color:#777;'>No recommendations available yet.</p>";
                return;
            }

            data.forEach(item => {
                container.innerHTML += `
                    <div class="reco-card">
                        <h4 style="color:#0a575d;">${item.title}</h4>
                        <p>${item.company_name}</p>
                        <p style="font-size:13px;color:#666;">${item.category}</p>
                    </div>
                `;
            });
        });
});
</script>

{% endblock %}